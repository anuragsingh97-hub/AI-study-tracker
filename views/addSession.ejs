<!DOCTYPE html>
<html>
<head>
  <title>Study Timer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<%- include("partials/navbar") %>

<div class="container mt-5 text-center">

  <div class="card shadow p-4 col-md-6 mx-auto">
    <h4 class="mb-3">Start Study Session</h4>

    <input type="text" id="subject" class="form-control mb-3" placeholder="Enter Subject Name">

    <h1 id="timer">00:00:00</h1>

    <div class="mt-3">
      <button class="btn btn-success" onclick="startTimer()">Start</button>
      <button class="btn btn-warning" onclick="pauseTimer()">Pause</button>
      <button class="btn btn-danger" onclick="addDistraction()">Distract</button>
      <button class="btn btn-primary" onclick="finishSession()">Finish</button>
    </div>

  </div>

</div>

<script>
let seconds = 0;
let distractionSeconds = 0;
let interval = null;
let isRunning = false;

function updateDisplay() {
    let hrs = Math.floor(seconds / 3600);
    let mins = Math.floor((seconds % 3600) / 60);
    let secs = seconds % 60;

    document.getElementById("timer").innerText =
        String(hrs).padStart(2,'0') + ":" +
        String(mins).padStart(2,'0') + ":" +
        String(secs).padStart(2,'0');
}

function startTimer() {
    if (!isRunning) {
        interval = setInterval(() => {
            seconds++;
            updateDisplay();
        }, 1000);
        isRunning = true;
    }
}

function pauseTimer() {
    clearInterval(interval);
    isRunning = false;
}

function addDistraction() {
    distractionSeconds += 30; // assume 30 sec distraction each click
    alert("Distraction Added (30 sec)");
}

function finishSession() {
    clearInterval(interval);

    const subject = document.getElementById("subject").value;

    if (!subject) {
        alert("Enter subject name");
        return;
    }

    fetch("/study/save-session", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            subject,
            studyTime: seconds,
            distractionTime: distractionSeconds
        })
    })
    .then(res => res.json())
    .then(data => {
        window.location.href = "/study/dashboard";
    });
}
</script>

</body>
</html>
