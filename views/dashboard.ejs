<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<%- include("partials/navbar") %>

<div class="container mt-4">

  <h3 class="mb-4">Your Study Dashboard</h3>

  <!-- Stats Cards -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card shadow text-center p-3">
        <h6>Total Sessions</h6>
        <h3><%= sessions.length %></h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow text-center p-3">
        <h6>Average Focus Score</h6>
        <h3>
          <%
            let avg = 0;
            if(sessions.length > 0){
              avg = sessions.reduce((sum,s)=>sum+s.focusScore,0)/sessions.length;
            }
          %>
          <%= avg.toFixed(1) %>%
        </h3>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card shadow text-center p-3">
        <h6>Total Study Time</h6>
        <h3>
          <%= sessions.reduce((sum,s)=>sum+s.studyTime,0) %> mins
        </h3>
      </div>
    </div>
  </div>

  <!-- Chart -->
  <div class="card shadow p-4 mb-4">
    <h5>Focus Score Trend</h5>
    <canvas id="focusChart"></canvas>
  </div>

  <!-- Table -->
  <div class="card shadow p-4">
    <h5>Session History</h5>
    <table class="table table-bordered mt-3">
      <tr>
        <th>Subject</th>
        <th>Study</th>
        <th>Distraction</th>
        <th>Focus %</th>
      </tr>

      <% sessions.forEach(s=>{ %>
        <tr>
          <td><%= s.subject %></td>
          <td><%= s.studyTime %></td>
          <td><%= s.distractionTime %></td>
          <td><%= s.focusScore.toFixed(2) %>%</td>
        </tr>
      <% }) %>
    </table>
  </div>

</div>

<script>
  const labels = <%-  JSON.stringify(sessions.map(s => new Date(s.date).toLocaleDateString())) %>;
  const data = <%-JSON.stringify(sessions.map(s => s.focusScore)) %>;

  new Chart(document.getElementById("focusChart"), {
    type: "line",
    data: {
      labels: labels,
      datasets: [{
        label: "Focus Score",
        data: data,
        borderWidth: 2,
        tension: 0.3
      }]
    }
  });
</script>

</body>
</html>
